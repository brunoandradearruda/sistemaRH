<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:c="">
<head>
    <title>Cadastro de Servidor</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
<!--    <script src="../js/verificarIdadeServidorCadastro.js"></script>-->

    <script type="text/javascript">
        $(document).ready(function () {
            $('#CPF').mask('000.000.000-00', {reverse: true});
            $('#CEP').mask('00000-000', {reverse: true});
            $('#PisPasep').mask('000.00000.00-0', {reverse: true});
            $('#matricula').mask('000.000-0', {reverse: true});
            $('#celular').mask('(00) 00000-0000');
            // Adiciona um ouvinte de evento ao formulário
            $('form').submit(function () {
                // Exibe o alerta após o envio do formulário
                alert('Cadastro realizado com sucesso!');
            });
        });
    </script>


</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse text-center" id="navbarNav">
        <ul class="navbar-nav mx-auto">

            <li class="nav-item">
                <a class="nav-link" href="/home">Página Inicial</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Férias</a>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                   aria-expanded="false">
                    Setor
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="/setor">Consultar</a>
                    <a class="dropdown-item" href="/cadastrar-departamento">Cadastrar</a>
                </div>
            </li>

            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
                   aria-haspopup="true" aria-expanded="false">
                    Servidores
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="/servidorlista">Consultar</a>
                    <a class="dropdown-item" href="/servidorCadastro">Cadastrar</a>
                </div>
            </li>

            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                   aria-expanded="false">
                    Cargos
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="/cargoslista">Consultar</a>
                    <a class="dropdown-item" href="/cargo">Cadastrar</a>
                </div>
            </li>

        </ul>
    </div>
</nav>

<div class="container">
    <h1 class="mt-5">Cadastro de Servidor</h1>
    <form action="#" th:action="@{/servidor}" method="post" class="mt-4">
        <!-- Outros campos... -->

        <div class="row">
            <div class="form-group col-md-2">
                <label for="matricula">Matrícula:</label>
                <input type="text" id="matricula" name="matricula" placeholder="Insira a matrícula" class="form-control" required/>
            </div>

            <div class="form-group col-md-2">
                <label for="PisPasep">PIS/PASEP:</label>
                <input type="text" id="PisPasep" name="PisPasep" placeholder="PIS/PASEP" class="form-control" onblur="converterParaMaiusculas(this)" required/>
            </div>

            <div class="form-group col-md-4">
                <label for="nome">Nome:</label>
                <input type="text" id="nome" name="nome" placeholder="Insira o nome do servidor" class="form-control" onblur="converterParaMaiusculas(this)" required/>
            </div>

            <!-- Novo campo Email ao lado do campo Nome -->
            <div class="form-group col-md-4">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" placeholder="Insira o email do servidor" class="form-control" required/>
            </div>
        </div>



        <div class="row">
            <div class="form-group col-md-2">
                <label for="sexo">Gênero:</label>
                <select id="sexo" name="sexo" class="form-control" onblur="converterParaMaiusculas(this)" required>
                    <option value="">Gênero</option>
                    <option value="CISGÊNERO">MASCULINO</option>
                    <option value="TRANSGÊNERO">FEMININO</option>
                    <option value="NÃO-BINÁRIO">OUTRO</option>

                </select>
            </div>

            <div class="form-group col-md-2">
                <label for="CPF">CPF:</label>
                <input type="text" id="CPF" name="CPF" placeholder="Insira o CPF do servidor" class="form-control"
                       onblur="converterParaMaiusculas(this)" required/>
            </div>

            <div class="form-group col-md-2">
                <label for="identidade">Identidade:</label>
                <input type="text" id="identidade" name="identidade" placeholder="Insira a identidade do servidor"
                       class="form-control" onblur="converterParaMaiusculas(this)" required/>
            </div>

            <div class="form-group col-md-2">
                <label for="orgaoExpeditor">Órgão Expeditor:</label>
                <input type="text" id="orgaoExpeditor" name="orgaoExpeditor" placeholder="Insira o órgão expeditor"
                       class="form-control" onblur="converterParaMaiusculas(this)" required/>
            </div>

            <div class="form-group col-md-2">
                <label for="celular">Celular:</label>
                <input type="text" id="celular" name="celular" placeholder="(__) _____-____" class="form-control"
                       required/>
            </div>

            <div class="form-group col-md-2">
                <label for="dataNascimento">Data de Nascimento:</label>
                <input type="date" id="dataNascimento" name="dataNascimento" class="form-control" required onblur="checkAge(this)"/>
            </div>
             </div>
        <script>
            function checkAge(input) {
                var dob = new Date(input.value);
                var today = new Date();
                var age = today.getFullYear() - dob.getFullYear();
                var m = today.getMonth() - dob.getMonth();
                if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
                    age--;
                }
                if (age < 16) {
                    alert("A idade do funcionário deve ser pelo menos 16 anos.");
                    input.value = "";
                } else if (age > 75) {
                    alert("A idade do funcionário não deve ser superior a 75 anos.");
                    input.value = "";
                }
            }
        </script>





        <div class="row">
            <div class="form-group col-md-2">
                <label for="CEP">CEP:</label>
                <input type="text" id="CEP" name="CEP" placeholder="Insira o CEP do servidor" class="form-control"
                       onblur="pesquisacep(this.value);" required/>
            </div>

            <div class="form-group col-md-5">
                <label for="endereco">Endereço:</label>
                <input type="text" id="endereco" name="endereco" placeholder="Insira o endereço do servidor"
                       class="form-control" onblur="converterParaMaiusculas(this)" required/>
            </div>

            <div class="form-group col-md-2">
                <label for="bairro">Bairro:</label>
                <input type="text" id="bairro" name="bairro" placeholder="Insira o bairro do servidor"
                       class="form-control" onblur="converterParaMaiusculas(this)" required/>
            </div>

            <div class="form-group col-md-2">
                <label for="cidade">Cidade:</label>
                <input type="text" id="cidade" name="cidade" placeholder="Insira a cidade do servidor"
                       class="form-control" onblur="converterParaMaiusculas(this)" required/>
            </div>

            <div class="form-group col-md-1">
                <label for="estado">Estado:</label>
                <input type="text" id="estado" name="estado" placeholder="UF" class="form-control"
                       onblur="converterParaMaiusculas(this)" required/>
            </div>
        </div>


        <div class="row">
            <div class="form-group col-md-2">
                <label for="dataAdmissao">Data de Admissão:</label>
                <input type="date" id="dataAdmissao" name="dataAdmissao" class="form-control"/>
            </div>



            <div class="row">
                <div class="form-group col-md-4">
                    <label for="simboloSelect">Escolha um Símbolo:</label>
                    <select id="simboloSelect" name="simbolo" class="form-control">
                        <option value="">Selecione um Símbolo</option>
                        <th:block th:each="cargo : ${cargos}">
                            <option th:value="${cargo.simbolo}" th:text="${cargo.simbolo}"></option>
                        </th:block>
                    </select>
                </div>

                <div class="form-group col-md-2" style="display: none;">
                    <label for="simbolo">Símbolo:</label>
                    <input type="text" id="simbolo" name="simbolo" class="form-control"/>
                </div>

                <div class="form-group col-md-4">
                    <label for="cargoSelect">Escolha um Cargo:</label>
                    <select id="cargoSelect" name="cargoSelect" class="form-control">
                        <option value="">Selecione um Cargo</option>
                        <th:block th:each="cargo : ${cargos}">
                            <option th:value="${cargo.id}" th:text="${cargo.nome}"></option>
                        </th:block>
                    </select>
                </div>

                <div class="form-group col-md-2" style="display: none;">
                    <label for="cargo">Cargo:</label>
                    <input type="text" id="cargo" name="cargo" class="form-control"/>
                </div>

                <div class="form-group col-md-4">
                    <label for="setorSelect">Escolha um Setor:</label>
                    <select id="setorSelect" name="setor" class="form-control">
                        <option value="">Selecione um Setor</option>
                        <th:block th:each="cargo : ${cargos}">
                            <option th:value="${cargo.setor}" th:text="${cargo.setor}"></option>
                        </th:block>
                    </select>
                </div>

                <div class="form-group col-md-4" style="display: none;">
                    <label for="setor">Setor:</label>
                    <input type="text" id="setor" name="setor" class="form-control"/>
                </div>
            </div>

            <div class="form-group col-md-3">
                <label>&nbsp;</label> <!-- Espaçador para alinhar com o combobox acima -->
                <a href="/cargos" class="btn btn-primary form-control">Cadastro/Cargo/Símbolo/Setor</a>
            </div>

            <form>
                <div class="form-group col-md-4">
                    <button type="submit" class="btn btn-primary mt-4">Cadastrar</button>
                    <!-- Alterado o tipo para "reset" para limpar os campos -->
                    <button type="reset" class="btn btn-secondary mt-4 ml-2">Limpar Campos</button>
                </div>
            </form>

            <script>

                function limpa_formulário_cep() {
                    // Limpa valores do formulário de cep.
                    $("#endereco").val("");
                    $("#bairro").val("");
                    $("#cidade").val("");
                    $("#estado").val("");
                }

                async function preenche_campos(cep) {
                    try {
                        const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                        const dados = await response.json();

                        if (!("erro" in dados)) {
                            // Atualiza os campos com os valores da consulta.
                            $("#endereco").val(dados.logradouro);
                            $("#bairro").val(dados.bairro);
                            $("#cidade").val(dados.localidade);
                            $("#estado").val(dados.uf);
                        } else {
                            // CEP pesquisado não foi encontrado.
                            limpa_formulário_cep();
                            alert("CEP não encontrado.");
                        }
                    } catch (error) {
                        console.error('Erro ao buscar CEP:', error);
                    }
                }

                function pesquisacep(valor) {
                    // Nova variável "cep" somente com dígitos.
                    var cep = valor.replace(/\D/g, '');

                    // Verifica se o campo cep possui valor informado.
                    if (cep !== "") {
                        // Expressão regular para validar o CEP.
                        var validacep = /^[0-9]{8}$/;

                        // Valida o formato do CEP.
                        if (validacep.test(cep)) {
                            // Preenche os campos com "..." enquanto consulta webservice.
                            limpa_formulário_cep();

                            // Consulta o webservice viacep.com.br/
                            preenche_campos(cep);
                        } else {
                            // CEP é inválido.
                            limpa_formulário_cep();
                            alert("Formato de CEP inválido.");
                        }
                    } else {
                        // CEP sem valor, limpa formulário.
                        limpa_formulário_cep();
                    }
                }

                function converterParaMaiusculas(elemento) {
                    elemento.value = elemento.value.toUpperCase();
                }
            </script>

            <script>
                $(document).ready(function () {
                    $('#cargoSelect').change(function () {
                        var selectedCargoNome = $(this).find('option:selected').text();
                        $('#cargo').val(selectedCargoNome);
                    });
                });
            </script>

        </div>
</body>
</html>
